<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distribución Normal (Gaussiana)</title>
    <style>
        /* Estilos del menú de navegación */
        .nav-container {
            background-color: #f5f5f5;
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .nav-menu {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            display: block;
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        .nav-link:hover {
            background-color: #45a049;
        }
        
        .nav-link.active {
            background-color: #3d8b40;
        }
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 2px;
        }
        .cell {
            width: 50px;
            height: 50px;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .results-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .chart-wrapper, .table-wrapper {
            flex: 1;
        }
        .chart {
            width: 100%;
            height: 300px;
        }
        .experiment {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .outcome {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            text-align: center;
            line-height: 40px;
            margin: 5px;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .probability-table {
            max-height: 300px;
            overflow-y: auto;
        }
        .sum-row {
            font-weight: bold;
            background-color: #f9f9f9;
        }
        .range-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .range-control input {
            width: 60px;
        }
        .color-legend {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .equation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: "Courier New", monospace;
            border-left: 4px solid #4CAF50;
        }
        .distribution-section {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .distribution-charts {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .distribution-chart {
            flex: 1;
            height: 250px;
        }
        .stats-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .stat-box {
            flex: 1;
            background-color: #e9f7ef;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .mean-section {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        .bin-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        .slider-container {
            flex-grow: 1;
        }
        .slider-container input[type="range"] {
            width: 100%;
        }
        .histogram-bin {
            height: 20px;
            background-color: #4CAF50;
            margin-top: 5px;
        }
        .probability-density {
            height: 20px;
            background-color: #2196F3;
            margin-top: 5px;
        }
        .interval-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 15px;
        }
        .interval-result {
            margin-top: 15px;
            padding: 10px;
            background-color: #e8f4f8;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
    </style>
</head>
<body>
    <div class="container">
  <ul class="nav-menu">
    <!-- SECCIÓN VARIABLES CONTINUAS -->
    <li class="nav-section">Variables Aleatorias Continuas</li>
    <li class="nav-item"><a href="distribuionuniforme.html" class="nav-link">Uniforme</a></li>
    <li class="nav-item"><a href="distribucionGaussiana.html" class="nav-link">Gaussiana</a></li>
    <li class="nav-item"><a href="distribucionexponencial.html" class="nav-link">Exponencial</a></li>

    <!-- Separador visual (opcional) -->
    <li class="nav-divider"><hr></li>

    <!-- SECCIÓN VARIABLES DISCRETAS -->
    <li class="nav-section">Variables Aleatorias Discretas</li>
    <li class="nav-item"><a href="distrubucionBernoulii.html" class="nav-link">Bernoulli</a></li>
    <li class="nav-item"><a href="distribucionBinomial.html" class="nav-link">Binomial</a></li>
    <li class="nav-item"><a href="distribucionBinomialNegativa.html" class="nav-link active">Binomial Negativa</a></li>
    <li class="nav-item"><a href="distribucionPoisson.html" class="nav-link">Poisson</a></li>
    <li class="nav-item"><a href="distribucionGeometrica.html" class="nav-link">Geometrica</a></li>
    <li class="nav-item"><a href="distribucionHipergeometrica.html" class="nav-link">HiperGeometrica</a></li>

    <!-- Separador visual (opcional) -->
    <li class="nav-divider"><hr></li>

    <!-- OTRAS SECCIONES -->
    <li class="nav-section">Otros</li>
    <li class="nav-item"><a href="juegosAzarDaniel.html" class="nav-link">Juego pelotas</a></li>
    <li class="nav-item"><a href="distribucionGama.html" class="nav-link">Gama</a></li>
</ul>
        
        <h1>Distribución Normal (Gaussiana)</h1>
        
        <div class="experiment">
            <h2>Simulación de Distribución Normal</h2>
            <div class="range-control">
                <label for="meanValue">Media (μ):</label>
                <input type="number" id="meanValue" step="0.1" value="0">
                <label for="stdDevValue">Desviación estándar (σ):</label>
                <input type="number" id="stdDevValue" min="0.1" step="0.1" value="1">
            </div>
            <p>La distribución normal es una distribución de probabilidad continua simétrica alrededor de su media.</p>
            
            <div class="bin-controls">
                <div>
                    <label for="binCount">Número de intervalos:</label>
                    <input type="number" id="binCount" min="5" max="50" value="15">
                </div>
                <div class="slider-container">
                    <label for="binCountSlider">Ajuste:</label>
                    <input type="range" id="binCountSlider" min="5" max="50" value="15">
                </div>
            </div>
        </div>
        
        <div class="mean-section">
            <h3>Propiedades de la Distribución Normal</h3>
            
            <div class="equation">
                <p><strong>Función de densidad de probabilidad (PDF):</strong></p>
                <p>f(x) = (1/(σ√(2π))) * e<sup>-(x-μ)²/(2σ²)</sup></p>
                <p>Donde:</p>
                <ul>
                    <li>μ = media</li>
                    <li>σ = desviación estándar</li>
                    <li>π ≈ 3.14159</li>
                    <li>e ≈ 2.71828</li>
                </ul>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <p><strong>Media teórica:</strong></p>
                    <p id="theoreticalMean">0</p>
                </div>
                
                <div class="stat-box">
                    <p><strong>Media de la simulación:</strong></p>
                    <p id="meanValueDisplay">0</p>
                </div>
                
                <div class="stat-box">
                    <p><strong>Diferencia:</strong></p>
                    <p id="meanDifference">0</p>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <p><strong>Desviación estándar teórica:</strong></p>
                    <p id="theoreticalStdDev">1</p>
                </div>
                
                <div class="stat-box">
                    <p><strong>Desviación estándar de la simulación:</strong></p>
                    <p id="stdDevValueDisplay">0</p>
                </div>
                
                <div class="stat-box">
                    <p><strong>Diferencia:</strong></p>
                    <p id="stdDevDifference">0</p>
                </div>
            </div>
            
            <div class="interval-controls">
                <h4>Calcular probabilidad en intervalo:</h4>
                <label for="intervalMin">Desde:</label>
                <input type="number" id="intervalMin" step="0.1" value="-1">
                <label for="intervalMax">Hasta:</label>
                <input type="number" id="intervalMax" step="0.1" value="1">
                <button id="calculateInterval">Calcular</button>
            </div>
            
            <div class="interval-result" id="intervalResult">
                <p>Probabilidad teórica en el intervalo: <span id="theoreticalIntervalProb">68.27%</span></p>
                <p>Probabilidad empírica en el intervalo: <span id="empiricalIntervalProb">0%</span></p>
            </div>
            
            <div class="distribution-chart">
                <canvas id="meanStdDevChart"></canvas>
            </div>
        </div>
        
        <div class="controls">
            <button id="simulate1">Simular 1 vez</button>
            <button id="simulate10">Simular 10 veces</button>
            <button id="simulate100">Simular 100 veces</button>
            <button id="simulate1000">Simular 1000 veces</button>
            <button id="reset">Reiniciar</button>
            <div>
                <label for="speed">Velocidad:</label>
                <input type="range" id="speed" min="1" max="10" value="5">
            </div>
        </div>

        <div class="distribution-section">
            <h3>Propiedades de la Distribución Normal</h3>
            
            <div class="equation">
                <p><strong>Características:</strong></p>
                <ul>
                    <li>Forma de campana simétrica</li>
                    <li>Media, mediana y moda coinciden</li>
                    <li>El 68.27% de los datos está dentro de μ ± σ</li>
                    <li>El 95.45% de los datos está dentro de μ ± 2σ</li>
                    <li>El 99.73% de los datos está dentro de μ ± 3σ</li>
                </ul>
            </div>
            
            <div class="distribution-charts">
                <div class="distribution-chart">
                    <canvas id="pdfChart"></canvas>
                </div>
                <div class="distribution-chart">
                    <canvas id="cdfChart"></canvas>
                </div>
            </div>
        </div>
        
        <div>
            <h3>Resultados</h3>
            <p>Total de simulaciones: <span id="total">0</span></p>
            <p>Parámetros: μ = <span id="currentMean">0</span>, σ = <span id="currentStdDev">1</span></p>
            
            <div class="results-container">
                <div class="chart-wrapper">
                    <div class="chart">
                        <canvas id="histogramChart"></canvas>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <div class="probability-table">
                        <table id="resultsTable">
                            <thead>
                                <tr>
                                    <th>Intervalo</th>
                                    <th>Frecuencia</th>
                                    <th>Frecuencia relativa</th>
                                    <th>Densidad teórica</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Las filas de la tabla se generarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div>
            <h3>Valores simulados</h3>
            <p>Últimos 100 valores generados (redondeados a 2 decimales):</p>
            <div class="grid-container" id="grid"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Configuración inicial
        let mean = 0;
        let stdDev = 1;
        let binCount = 15;
        let results = [];
        let bins = {};
        let binWidth = 0;
        let binRanges = [];
        let totalSimulations = 0;
        let gridCells = [];
        let animationId = null;
        let simulationSpeed = 5;
        let colorPalette = '#4CAF50';
        let meanHistory = [];
        let stdDevHistory = [];

        // Elementos del DOM
        const gridContainer = document.getElementById('grid');
        const totalElement = document.getElementById('total');
        const meanValueInput = document.getElementById('meanValue');
        const stdDevValueInput = document.getElementById('stdDevValue');
        const currentMeanElement = document.getElementById('currentMean');
        const currentStdDevElement = document.getElementById('currentStdDev');
        const speedControl = document.getElementById('speed');
        const resultsTableBody = document.querySelector('#resultsTable tbody');
        const histogramCtx = document.getElementById('histogramChart').getContext('2d');
        const theoreticalMeanElement = document.getElementById('theoreticalMean');
        const theoreticalStdDevElement = document.getElementById('theoreticalStdDev');
        const meanValueDisplay = document.getElementById('meanValueDisplay');
        const stdDevValueDisplay = document.getElementById('stdDevValueDisplay');
        const meanDifferenceElement = document.getElementById('meanDifference');
        const stdDevDifferenceElement = document.getElementById('stdDevDifference');
        const binCountInput = document.getElementById('binCount');
        const binCountSlider = document.getElementById('binCountSlider');
        const intervalMinInput = document.getElementById('intervalMin');
        const intervalMaxInput = document.getElementById('intervalMax');
        const theoreticalIntervalProb = document.getElementById('theoreticalIntervalProb');
        const empiricalIntervalProb = document.getElementById('empiricalIntervalProb');
        
        let histogramChart;
        let pdfChart;
        let cdfChart;
        let meanStdDevChart;

        // Inicializar la distribución
        function initializeDistribution() {
            mean = parseFloat(meanValueInput.value);
            stdDev = parseFloat(stdDevValueInput.value);
            binCount = parseInt(binCountInput.value);
            
            // Validar los valores
            if (stdDev <= 0) {
                stdDev = 0.1;
                stdDevValueInput.value = stdDev;
            }
            
            // Actualizar la visualización de parámetros
            currentMeanElement.textContent = mean;
            currentStdDevElement.textContent = stdDev;
            theoreticalMeanElement.textContent = mean;
            theoreticalStdDevElement.textContent = stdDev;
            
            // Reiniciar resultados
            results = [];
            bins = {};
            totalSimulations = 0;
            gridContainer.innerHTML = '';
            gridCells = [];
            meanHistory = [];
            stdDevHistory = [];
            
            // Calcular rangos de los bins
            calculateBinRanges();
            
            // Actualizar la tabla de resultados
            updateResultsTable();
            
            // Inicializar o actualizar los gráficos
            initializeCharts();
            
            // Actualizar la UI
            updateUI();
        }

        // Calcular rangos de los bins para el histograma
        function calculateBinRanges() {
            // Usamos ±4 desviaciones estándar para cubrir la mayoría de los datos
            const rangeMin = mean - 4 * stdDev;
            const rangeMax = mean + 4 * stdDev;
            binWidth = (rangeMax - rangeMin) / binCount;
            
            binRanges = [];
            for (let i = 0; i < binCount; i++) {
                const binMin = rangeMin + i * binWidth;
                const binMax = rangeMin + (i + 1) * binWidth;
                binRanges.push({ min: binMin, max: binMax });
                bins[`${binMin.toFixed(2)}-${binMax.toFixed(2)}`] = 0;
            }
        }

        // Función de densidad de probabilidad normal
        function normalPDF(x, mu, sigma) {
            const variance = sigma * sigma;
            const exponent = -((x - mu) ** 2) / (2 * variance);
            return (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(exponent);
        }

        // Función de distribución acumulativa normal (aproximación)
        function normalCDF(x, mu, sigma) {
            // Aproximación de Abramowitz y Stegun
            const z = (x - mu) / sigma;
            const t = 1 / (1 + 0.2316419 * Math.abs(z));
            const d = 0.3989423 * Math.exp(-z * z / 2);
            let prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
            
            if (z > 0) {
                prob = 1 - prob;
            } else {
                prob = 1 - prob;
            }
            
            return z < 0 ? prob : 1 - prob;
        }

        // Inicializar los gráficos
        function initializeCharts() {
            const labels = binRanges.map(range => `${range.min.toFixed(2)}-${range.max.toFixed(2)}`);
            const backgroundColors = labels.map(() => colorPalette);
            
            // Gráfico de histograma
            if (histogramChart) {
                histogramChart.destroy();
            }
            
            histogramChart = new Chart(histogramCtx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frecuencia de resultados',
                        data: new Array(labels.length).fill(0),
                        backgroundColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Gráfico PDF
            if (pdfChart) {
                pdfChart.destroy();
            }
            
            const pdfCtx = document.getElementById('pdfChart').getContext('2d');
            
            // Crear puntos para la curva PDF
            const pdfPoints = 100;
            const pdfMin = mean - 4 * stdDev;
            const pdfMax = mean + 4 * stdDev;
            const pdfStep = (pdfMax - pdfMin) / pdfPoints;
            const pdfLabels = [];
            const pdfData = [];
            
            for (let x = pdfMin; x <= pdfMax; x += pdfStep) {
                pdfLabels.push(x.toFixed(2));
                pdfData.push(normalPDF(x, mean, stdDev));
            }
            
            pdfChart = new Chart(pdfCtx, {
                type: 'line',
                data: {
                    labels: pdfLabels,
                    datasets: [{
                        label: 'Función de Densidad de Probabilidad (PDF)',
                        data: pdfData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
            
            // Gráfico CDF
            if (cdfChart) {
                cdfChart.destroy();
            }
            
            const cdfCtx = document.getElementById('cdfChart').getContext('2d');
            
            // Crear puntos para la curva CDF
            const cdfPoints = 100;
            const cdfMin = mean - 4 * stdDev;
            const cdfMax = mean + 4 * stdDev;
            const cdfStep = (cdfMax - cdfMin) / cdfPoints;
            const cdfLabels = [];
            const cdfData = [];
            
            for (let x = cdfMin; x <= cdfMax; x += cdfStep) {
                cdfLabels.push(x.toFixed(2));
                cdfData.push(normalCDF(x, mean, stdDev));
            }
            
            cdfChart = new Chart(cdfCtx, {
                type: 'line',
                data: {
                    labels: cdfLabels,
                    datasets: [{
                        label: 'Función de Distribución Acumulativa (CDF)',
                        data: cdfData,
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: false,
                            min: 0,
                            max: 1
                        }
                    }
                }
            });
            
            // Gráfico de media y desviación estándar
            if (meanStdDevChart) {
                meanStdDevChart.destroy();
            }
            
            const meanStdDevCtx = document.getElementById('meanStdDevChart').getContext('2d');
            meanStdDevChart = new Chart(meanStdDevCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Media de la simulación',
                        data: [],
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        fill: true,
                        tension: 0.1
                    }, {
                        label: 'Desviación estándar de la simulación',
                        data: [],
                        borderColor: '#FF6384',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        fill: true,
                        tension: 0.1
                    }, {
                        label: 'Media teórica',
                        data: [],
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0)',
                        borderDash: [5, 5],
                        borderWidth: 2,
                        pointRadius: 0
                    }, {
                        label: 'Desviación estándar teórica',
                        data: [],
                        borderColor: '#FF9800',
                        backgroundColor: 'rgba(255, 152, 0, 0)',
                        borderDash: [5, 5],
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Valor'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Número de simulaciones'
                            }
                        }
                    }
                }
            });
        }

        // Actualizar la tabla de resultados
        function updateResultsTable() {
            resultsTableBody.innerHTML = '';
            
            for (let range in bins) {
                const row = document.createElement('tr');
                
                const rangeCell = document.createElement('td');
                rangeCell.textContent = range;
                
                const freqCell = document.createElement('td');
                freqCell.textContent = bins[range];
                freqCell.id = `freq-${range}`;
                
                const relFreqCell = document.createElement('td');
                relFreqCell.textContent = '0%';
                relFreqCell.id = `relFreq-${range}`;
                
                // Calcular densidad teórica para este bin
                const [binMin, binMax] = range.split('-').map(parseFloat);
                const binCenter = (binMin + binMax) / 2;
                const theoreticalDensity = normalPDF(binCenter, mean, stdDev) * binWidth;
                
                const densityCell = document.createElement('td');
                densityCell.textContent = theoreticalDensity.toFixed(4);
                
                row.appendChild(rangeCell);
                row.appendChild(freqCell);
                row.appendChild(relFreqCell);
                row.appendChild(densityCell);
                
                resultsTableBody.appendChild(row);
            }
        }

        // Simular un valor normal
        function simulate() {
            // Método de Box-Muller para generar valores normales
            let u = 0, v = 0;
            while(u === 0) u = Math.random(); // Convertir (0,1] a (0,1)
            while(v === 0) v = Math.random();
            
            const z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
            const value = mean + stdDev * z;
            
            results.push(value);
            totalSimulations++;
            
            // Asignar a un bin
            for (let i = 0; i < binRanges.length; i++) {
                const range = binRanges[i];
                if (value >= range.min && value < range.max) {
                    const rangeKey = `${range.min.toFixed(2)}-${range.max.toFixed(2)}`;
                    bins[rangeKey]++;
                    break;
                }
            }
            
            return value;
        }

        // Calcular la media de los resultados
        function calculateMean() {
            if (results.length === 0) return 0;
            const sum = results.reduce((a, b) => a + b, 0);
            return sum / results.length;
        }

        // Calcular la desviación estándar de los resultados
        function calculateStdDev(sampleMean) {
            if (results.length < 2) return 0;
            const squaredDifferences = results.map(x => Math.pow(x - sampleMean, 2));
            const variance = squaredDifferences.reduce((a, b) => a + b, 0) / results.length;
            return Math.sqrt(variance);
        }

        // Calcular probabilidad empírica en un intervalo
        function calculateEmpiricalIntervalProbability(min, max) {
            if (results.length === 0) return 0;
            const count = results.filter(x => x >= min && x <= max).length;
            return count / results.length;
        }

        // Calcular probabilidad teórica en un intervalo
        function calculateTheoreticalIntervalProbability(min, max) {
            return normalCDF(max, mean, stdDev) - normalCDF(min, mean, stdDev);
        }

        // Actualizar la UI
        function updateUI(result) {
            totalElement.textContent = totalSimulations;
            
            // Actualizar datos del gráfico de histograma
            const labels = Object.keys(bins);
            const data = labels.map(label => bins[label]);
            
            histogramChart.data.datasets[0].data = data;
            histogramChart.update();
            
            // Actualizar tabla de resultados
            for (let range in bins) {
                document.getElementById(`freq-${range}`).textContent = bins[range];
                
                const relFreq = totalSimulations > 0 ? (bins[range] / totalSimulations * 100).toFixed(2) : 0;
                document.getElementById(`relFreq-${range}`).textContent = relFreq + '%';
            }
            
            // Calcular y mostrar media y desviación estándar
            const sampleMean = calculateMean();
            const sampleStdDev = calculateStdDev(sampleMean);
            
            meanValueDisplay.textContent = sampleMean.toFixed(4);
            stdDevValueDisplay.textContent = sampleStdDev.toFixed(4);
            
            // Calcular diferencias con valores teóricos
            const meanDifference = Math.abs(sampleMean - mean);
            const stdDevDifference = Math.abs(sampleStdDev - stdDev);
            
            meanDifferenceElement.textContent = meanDifference.toFixed(4);
            stdDevDifferenceElement.textContent = stdDevDifference.toFixed(4);
            
            // Actualizar historial de media y desviación estándar
            meanHistory.push(sampleMean);
            stdDevHistory.push(sampleStdDev);
            
            meanStdDevChart.data.labels = Array.from({length: meanHistory.length}, (_, i) => i + 1);
            meanStdDevChart.data.datasets[0].data = meanHistory;
            meanStdDevChart.data.datasets[1].data = stdDevHistory;
            meanStdDevChart.data.datasets[2].data = Array(meanHistory.length).fill(mean);
            meanStdDevChart.data.datasets[3].data = Array(stdDevHistory.length).fill(stdDev);
            meanStdDevChart.update();
            
            // Actualizar probabilidad del intervalo si hay valores
            const intervalMin = parseFloat(intervalMinInput.value);
            const intervalMax = parseFloat(intervalMaxInput.value);
            
            if (!isNaN(intervalMin)) {
                const theoreticalProb = calculateTheoreticalIntervalProbability(intervalMin, intervalMax) * 100;
                theoreticalIntervalProb.textContent = theoreticalProb.toFixed(2) + '%';
                
                if (results.length > 0) {
                    const empiricalProb = calculateEmpiricalIntervalProbability(intervalMin, intervalMax) * 100;
                    empiricalIntervalProb.textContent = empiricalProb.toFixed(2) + '%';
                }
            }
            
            if (result !== undefined) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.style.backgroundColor = colorPalette;
                cell.textContent = result.toFixed(2);
                cell.title = `Valor: ${result.toFixed(4)}`;
                gridContainer.appendChild(cell);
                gridCells.push(cell);

                if (gridCells.length > 100) {
                    gridContainer.removeChild(gridCells[0]);
                    gridCells.shift();
                }
            }
        }

        // Simular múltiples ensayos
        function simulateMultiple(times, delay = 0) {
            if (animationId) {
                cancelAnimationFrame(animationId);
                clearTimeout(animationId);
            }

            let count = 0;
            let delayTime = (11 - simulationSpeed) * 20;

            function runSimulation() {
                if (count < times) {
                    const result = simulate();
                    updateUI(result);
                    count++;

                    if (delay > 0) {
                        animationId = setTimeout(runSimulation, delayTime);
                    } else {
                        animationId = requestAnimationFrame(runSimulation);
                    }
                } else {
                    animationId = null;
                }
            }

            runSimulation();
        }

        // Event listeners
        document.getElementById('simulate1').addEventListener('click', () => {
            const result = simulate();
            updateUI(result);
        });

        document.getElementById('simulate10').addEventListener('click', () => {
            simulateMultiple(10, 100);
        });

        document.getElementById('simulate100').addEventListener('click', () => {
            simulateMultiple(100, 10);
        });

        document.getElementById('simulate1000').addEventListener('click', () => {
            simulateMultiple(1000);
        });

        document.getElementById('reset').addEventListener('click', () => {
            initializeDistribution();
        });

        document.getElementById('calculateInterval').addEventListener('click', () => {
            const min = parseFloat(intervalMinInput.value);
            const max = parseFloat(intervalMaxInput.value);
            
            if (isNaN(min) || isNaN(max) || min >= max) {
                alert("Por favor ingrese un intervalo válido (mínimo < máximo)");
                return;
            }
            
            const theoreticalProb = calculateTheoreticalIntervalProbability(min, max) * 100;
            theoreticalIntervalProb.textContent = theoreticalProb.toFixed(2) + '%';
            
            if (results.length > 0) {
                const empiricalProb = calculateEmpiricalIntervalProbability(min, max) * 100;
                empiricalIntervalProb.textContent = empiricalProb.toFixed(2) + '%';
            } else {
                empiricalIntervalProb.textContent = "0% (sin datos)";
            }
        });

        speedControl.addEventListener('input', () => {
            simulationSpeed = parseInt(speedControl.value);
        });

        meanValueInput.addEventListener('change', () => {
            initializeDistribution();
        });

        stdDevValueInput.addEventListener('change', () => {
            initializeDistribution();
        });

        binCountInput.addEventListener('change', () => {
            binCount = parseInt(binCountInput.value);
            binCountSlider.value = binCount;
            initializeDistribution();
        });

        binCountSlider.addEventListener('input', () => {
            binCount = parseInt(binCountSlider.value);
            binCountInput.value = binCount;
            initializeDistribution();
        });

        // Inicializar al cargar la página
        initializeDistribution();
    </script>
</body>
</html>